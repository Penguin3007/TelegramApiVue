function isString(i){return"string"==typeof i}function isFunction(i){return"function"==typeof i}function isArray(i){return Array.isArray(i)}function isDefined(i){return void 0!==i}function format(i,t){return i.replace(/\{(\d+)}/g,function(i,r){return t[parseInt(r)]})}function extend(){for(var i=Array.prototype.slice.call(arguments),t=i[0],r=1;r<i.length;r++){var n=i[r];for(var e in n)n.hasOwnProperty(e)&&isDefined(n[e])&&(t[e]=n[e])}return t}function union(){for(var i=Array.prototype.slice.call(arguments),t=[],r=0;r<i.length;r++){var n=i[r];if(!isArray(n))throw new Error(format("Argument {0} is not array",[r+1]));for(var e=0;e<n.length;e++)t.push(n[e])}return t}function Module(i,t,r){this._name=i,this._deps=t,this._ctor=r}function ContainerModule(){this._modules={}}function buildModule(i,t,r){if(!i.isReady()){if(-1!==t.indexOf(i._name))throw new Error(utils.format(strings.ERROR_CIRCULAR_DEPENDENCY,[i._name]));var n=[];i._deps.forEach(function(e){var s=r[e];if(!utils.isDefined(s))throw new Error(utils.format(strings.ERROR_MODULE_NOT_FOUND,[e]));s.isReady()||(t.push(i._name),buildModule(s,t,r),t.pop()),n.push(s.getInstance())}),i.build(n)}}var strings={ERROR_CIRCULAR_DEPENDENCY:"{0}: Circular dependency",ERROR_MODULE_ALREADY_DEFINED:"{0}: Module is already defined",ERROR_MODULE_ALREADY_INITIALIZED:"{0}: Module is already initialized",ERROR_MODULE_INITIALIZE:"{0}: Module return empty result",ERROR_MODULE_NAME_INCORRECT:"Incorrect module name",ERROR_MODULE_NOT_INITIALIZED:"{0}: Module is not initialized",ERROR_MODULE_NOT_FOUND:"{0}: Module not found",ERROR_PARAMETERS_INCORRECT:"Incorrect parameters"},utils={isString:isString,isFunction:isFunction,isArray:isArray,isDefined:isDefined,format:format,extend:extend,union:union};Module.prototype.isReady=function(){return utils.isDefined(this._instance)},Module.prototype.build=function(i){if(this.isReady())throw new Error(utils.format(strings.ERROR_MODULE_ALREADY_INITIALIZED,[this._name]));if(this._instance=this._ctor.apply(null,i),!this.isReady())throw new Error(utils.format(strings.ERROR_MODULE_INITIALIZE,[this._name]))},Module.prototype.getInstance=function(){if(!this.isReady())throw new Error(utils.format(strings.ERROR_MODULE_NOT_INITIALIZED,[this._name]));return this._instance},ContainerModule.prototype.register=function(i,t,r){if(!utils.isString(i))throw new Error(strings.ERROR_MODULE_NAME_INCORRECT);if(utils.isDefined(this._modules[i]))throw new Error(utils.format(strings.ERROR_MODULE_ALREADY_DEFINED,[i]));if(utils.isFunction(t)&&(r=t,t=[]),!utils.isArray(t)||!utils.isFunction(r))throw new Error(strings.ERROR_PARAMETERS_INCORRECT);return utils.isArray(r.dependencies)&&(t=utils.union(t,r.dependencies)),this._modules[i]=new Module(i,t,r),this},ContainerModule.prototype.resolve=function(i){if(!utils.isDefined(this._modules[i]))throw new Error(utils.format(strings.ERROR_MODULE_NOT_FOUND,[i]));return this._modules[i].getInstance()},ContainerModule.prototype.init=function(){for(var i in this._modules)this._modules.hasOwnProperty(i)&&buildModule(this._modules[i],[],this._modules);return this};